# backend/deduper/deduper.py
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.metrics.pairwise import cosine_similarity

def dedupe(texts: list[str], threshold: float = 0.85) -> list[str]:
    if not texts:
        return []
    vec = TfidfVectorizer().fit_transform(texts)
    sim = cosine_similarity(vec)
    keep = []
    removed = set()
    for i in range(len(texts)):
        if i in removed:
            continue
        keep.append(texts[i])
        for j in range(i + 1, len(texts)):
            if j in removed:
                continue
            if sim[i, j] >= threshold:
                removed.add(j)
    return keep
